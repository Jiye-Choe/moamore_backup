<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="team">
	<select id="countOpenAll" resultType="int">
	<![CDATA[
		SELECT count(*) FROM TEAM WHERE STATUS=2 AND ISOPEN=1 AND to_char(START_DAY, 'yyyymmdd' ) <= to_char(sysdate, 'yyyymmdd') AND to_char(END_DAY, 'yyyymmdd' ) >= to_char(sysdate, 'yyyymmdd')
	]]>
	</select>
	
	<select id="countEndAll" resultType="int">
	<![CDATA[
		SELECT count(*) FROM TEAM WHERE STATUS=2 AND ISOPEN=1 AND to_char(END_DAY, 'yyyymmdd' ) < to_char(sysdate, 'yyyymmdd')
	]]>
	</select>
	
	<select id="countOpenApAll" resultType="int">
	<![CDATA[
		SELECT count(*) FROM TEAM WHERE STATUS=2 AND ISOPEN=1 AND to_char(START_DAY, 'yyyymmdd' ) > to_char(sysdate, 'yyyymmdd')
	]]>
	</select>
	
	<select id="selectOpenAll" parameterType="hashmap" resultType="teamDTO">
		<![CDATA[
		select * FROM (SELECT rownum r,team_no,subject,amount,start_day,end_day,people FROM (SELECT team_no,subject,amount,start_day,end_day,people from team where status=2 and ISOPEN=1 AND to_char(START_DAY, 'yyyymmdd' ) <= to_char(sysdate, 'yyyymmdd') AND to_char(END_DAY, 'yyyymmdd' ) >= to_char(sysdate, 'yyyymmdd') order by team_no desc)) where r >= #{start} and r <= #{end} order by r asc
		]]>
	</select>
	
	<select id="selectEndAll" parameterType="hashmap" resultType="teamDTO">
		<![CDATA[
		select * FROM (SELECT rownum r,team_no,subject,amount,start_day,end_day,people FROM (SELECT team_no,subject,amount,start_day,end_day,people from team where status=2 and ISOPEN=1 AND to_char(END_DAY, 'yyyymmdd' ) < to_char(sysdate, 'yyyymmdd') order by team_no desc)) where r >= #{start} and r <= #{end} order by r asc
		]]>
	</select>
	
	<select id="selectOpenApAll" parameterType="hashmap" resultType="teamDTO">
		<![CDATA[
		select * FROM (SELECT rownum r,team_no,subject,amount,start_day,end_day,people FROM (SELECT team_no,subject,amount,start_day,end_day,people from team where status=2 and ISOPEN=1 AND to_char(START_DAY, 'yyyymmdd' ) > to_char(sysdate, 'yyyymmdd') order by team_no desc)) where r >= #{start} and r <= #{end} order by r asc
		]]>
	</select>
	
	<select id="selectOne" parameterType="int" resultType="teamDTO">
		select * from team where team_no=#{value}
	</select>
	
	
	
	<select id="countAllTeamMyRequest" parameterType="string" resultType="int">
		SELECT count(*) FROM TEAM WHERE leader=#{value}
	</select>
	
	<select id="selectAllTeamMyRequest" parameterType="hashmap" resultType="teamDTO">
	<![CDATA[
		select * from (select rownum r,team_no,subject,content,amount,start_day,end_day,people,status,isopen,password from (SELECT team_no,subject,content,amount,start_day,end_day,people,status,isopen,password from team where leader=#{leader} order by team_no desc)) where r >= #{start} and r <= #{end} order by r asc
	]]>
	</select>
	
	
	
	<insert id="insertTeamArticle" parameterType="teamDTO">
		insert into team values(team_seq.nextVal, #{subject}, #{content}, #{amount}, to_date(#{start_day},'YYYYMMDD'), to_date(#{end_day},'YYYYMMDD'), #{leader}, #{people}, 0, #{isopen}, #{password})
		<selectKey keyProperty="team_no" resultType="int" order="AFTER">
			select team_seq.currVal from dual
		</selectKey>
	</insert>
	<insert id="insertTeamArticleNoPw" parameterType="teamDTO">
		insert into team values(team_seq.nextVal, #{subject}, #{content}, #{amount}, to_date(#{start_day},'YYYYMMDD'), to_date(#{end_day},'YYYYMMDD'), #{leader}, #{people}, 0, #{isopen}, null)
	</insert>
	
	<update id="updateTeamStatus" parameterType="teamDTO">
		update team set status=#{status} where team_no=#{team_no}
	</update>
</mapper>